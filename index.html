<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>LearnTogether</title>

    <link type="text/css" rel="stylesheet" href="https://cdn.firebase.com/libs/firebaseui/1.0.1/firebaseui.css" />
    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/css/materialize.min.css">

    <style>

    </style>

    <script type="text/javascript" src="https://code.jquery.com/jquery-2.1.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.98.2/js/materialize.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase.js"></script>

    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/3.8.0/firebase-database.js"></script>

    <script src="https://cdn.firebase.com/libs/firebaseui/1.0.1/firebaseui.js"></script>
    <script>


        var displayName, email, uid;
        var database, userReference;

        var config = {
            apiKey: "AIzaSyBLA6sDqXwnMX6tJayM4dmYCPRzt5CW91M",
            authDomain: "learntogether-a250b.firebaseapp.com",
            databaseURL: "https://learntogether-a250b.firebaseio.com",
            projectId: "learntogether-a250b",
            storageBucket: "learntogether-a250b.appspot.com",
            messagingSenderId: "3175571907"
        };
        firebase.initializeApp(config);

        SignOut = function () {
            firebase.auth().signOut().then(function() {
                console.log("Signed out forcefully");
            }, function(error) {
                // An error happened.
            });
        };

        function ShowLoggedInComponents() {
            console.log("Tearing down");
            $("#LoginComponents").hide();
            $("#SignOutButton").show();

        }
        function ShowLoginComponents() {
            $("#LoginComponents").show();
            $("#SignOutButton").hide();
        }

        initApp = function(param) {
            firebase.auth().onAuthStateChanged(function(user) {
                if (user) {
                    // User is signed in.
                    displayName = user.displayName;
                    email = user.email;
                    uid = user.uid;

                    console.log(user);


                    user.getToken().then(function(accessToken) {
                        if(email.indexOf('monash.edu') < 0){
                            alert("Use monash email");
                            SignOut();
                        }else{
                            ShowLoggedInComponents();
                            database = firebase.database();
                            userReference = database.ref('users/'+uid);

                            userReference.on('value', function(snapshot) {
                                alert(snapshot);
                            });
                        }
                    });

                } else {
                    // User is signed out.
                    console.log("Signed out");
                    ShowLoginComponents()
                }
            }, function(error) {
                console.log(error);
            });
        };


        var uiConfig = {
            signInSuccessUrl: '.',
            signInOptions: [
                // Leave the lines as is for the providers you want to offer your users.
                firebase.auth.GoogleAuthProvider.PROVIDER_ID,
                firebase.auth.EmailAuthProvider.PROVIDER_ID
            ],
            // Terms of service url.
            tosUrl: '<your-tos-url>'
        };




    </script>


</head>
<body>


<!-- Modal Structure -->


<nav>
    <div class="nav-wrapper">
        <a href="#" class="brand-logo" style="padding-left: 1%">LearnTogether</a>
        <ul id="nav-mobile" class="right hide-on-med-and-down">
            <li><a href="#">About</a></li>
            <li><a style="display: none" id="SignOutButton" onclick="SignOut()">Sign Out</a></li>
            <li>
                <div class="preloader-wrapper big active" style="display: none">
                    <div class="spinner-layer spinner-blue-only">
                        <div class="circle-clipper left">
                            <div class="circle"></div>
                        </div><div class="gap-patch">
                        <div class="circle"></div>
                    </div><div class="circle-clipper right">
                        <div class="circle"></div>
                    </div>
                    </div>
                </div>
            </li>
        </ul>



    </div>
</nav>

<div id="LoginComponents" style="display: none">
<div class="section white">
    <div class="row container">
        <h2 class="header">Enhance your learning</h2>
        <ul class="grey-text text-darken-3 lighten-3">
            <li><h4>Compare</h4></li>
            <li><h4>Connect</h4></li>
            <li><h4>Collaborate</h4></li>
        </ul>
    </div>
</div>

<div id="SignInModal" class="modal" style="display: block">
    <div class="modal-content">
        <h4>Login or Sign Up</h4>
        <p>Use your Monash email to unlock a whole new learning experience!!</p>
    </div>
    <div id="FireBaseUiAuth">
    </div>
    <div class="modal-footer">
        <a href="#">Terms and Conditions</a>
        <!--<a onclick="ToggleShowSignIn()" class="modal-action modal-close waves-effect waves-green btn-flat">Close</a>-->
    </div>
</div>
</div>


<div id="SignedInComponents">
    <div class="row">
        <div class="col s4">
            <ul class="tabs">
                <li class="tab col s3"><a class="active" href="#test1">My Classes</a></li>
                <li class="tab col s3"><a href="#test2">Swap Classes</a></li>
                <li class="tab col s3"><a href="#test3">Peers</a></li>
            </ul>
        </div>
        <div id="test1" class="col s12">Test 1</div>
        <div id="test2" class="col s12">Test 2</div>
        <div id="test3" class="col s12">Test 3</div>
    </div>



</div>

</body>



<script>

    window.addEventListener('load', function() {
        initApp()
    });

    // Initialize the FirebaseUI Widget using Firebase.
    var ui = new firebaseui.auth.AuthUI(firebase.auth());
    // The start method will wait until the DOM is loaded.
    ui.start('#FireBaseUiAuth', uiConfig);

</script>

</html>